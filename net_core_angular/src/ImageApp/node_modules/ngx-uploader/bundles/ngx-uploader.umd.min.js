!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/core"),require("rxjs"),require("rxjs/operators")):"function"==typeof define&&define.amd?define("ngx-uploader",["exports","@angular/core","rxjs","rxjs/operators"],t):t(e["ngx-uploader"]={},e.ng.core,e.rxjs,e.rxjs.operators)}(this,function(e,i,o,s){"use strict";var m={Queue:0,Uploading:1,Done:2,Cancelled:3};function u(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,o=n.call(e),s=[];try{for(;(void 0===t||0<t--)&&!(r=o.next()).done;)s.push(r.value)}catch(u){i={error:u}}finally{try{r&&!r.done&&(n=o["return"])&&n.call(o)}finally{if(i)throw i.error}}return s}function y(e){if(0===e)return"0 Byte";var t=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,t)).toFixed(2))+" "+["Bytes","KB","MB","GB","TB","PB"][t]}m[m.Queue]="Queue",m[m.Uploading]="Uploading",m[m.Done]="Done",m[m.Cancelled]="Cancelled";var a=function(){function e(e,t,n){void 0===e&&(e=Number.POSITIVE_INFINITY),void 0===t&&(t=["*"]),void 0===n&&(n=Number.POSITIVE_INFINITY);var r=this;this.queue=[],this.serviceEvents=new i.EventEmitter,this.uploadScheduler=new o.Subject,this.subs=[],this.contentTypes=t,this.maxUploads=n,this.uploadScheduler.pipe(s.mergeMap(function(e){return r.startUpload(e)},e)).subscribe(function(e){return r.serviceEvents.emit(e)})}return e.prototype.handleFiles=function(e){var t,o=this,n=[].reduce.call(e,function(e,t,n){var r=e.length+o.queue.length+1;if(o.isContentTypeAllowed(t.type)&&r<=o.maxUploads)e=e.concat(t);else{var i=o.makeUploadFile(t,n);o.serviceEvents.emit({type:"rejected",file:i})}return e},[]);(t=this.queue).push.apply(t,function r(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(u(arguments[t]));return e}([].map.call(n,function(e,t){var n=o.makeUploadFile(e,t);return o.serviceEvents.emit({type:"addedToQueue",file:n}),n}))),this.serviceEvents.emit({type:"allAddedToQueue"})},e.prototype.initInputEvents=function(e){var u=this;return e.subscribe(function(t){switch(t.type){case"uploadFile":var e=u.queue.findIndex(function(e){return e===t.file});-1!==e&&t.file&&u.uploadScheduler.next({file:u.queue[e],event:t});break;case"uploadAll":u.queue.filter(function(e){return e.progress.status===m.Queue}).forEach(function(e){return u.uploadScheduler.next({file:e,event:t})});break;case"cancel":var n=t.id||null;if(!n)return;var r=u.subs.findIndex(function(e){return e.id===n});if(-1!==r&&u.subs[r].sub){u.subs[r].sub.unsubscribe();var i=u.queue.findIndex(function(e){return e.id===n});-1!==i&&(u.queue[i].progress.status=m.Cancelled,u.serviceEvents.emit({type:"cancelled",file:u.queue[i]}))}break;case"cancelAll":u.subs.forEach(function(t){t.sub&&t.sub.unsubscribe();var e=u.queue.find(function(e){return e.id===t.id});e&&(e.progress.status=m.Cancelled,u.serviceEvents.emit({type:"cancelled",file:e}))});break;case"remove":if(!t.id)return;var o=u.queue.findIndex(function(e){return e.id===t.id});if(-1!==o){var s=u.queue[o];u.queue.splice(o,1),u.serviceEvents.emit({type:"removed",file:s})}break;case"removeAll":u.queue.length&&(u.queue=[],u.serviceEvents.emit({type:"removedAll"}))}})},e.prototype.startUpload=function(n){var r=this;return new o.Observable(function(t){var e=r.uploadFile(n.file,n.event).subscribe(function(e){t.next(e)},function(e){t.error(e),t.complete()},function(){t.complete()});r.subs.push({id:n.file.id,sub:e})})},e.prototype.uploadFile=function(f,h){var v=this;return new o.Observable(function(r){var e=h.url||"",t=h.method||"POST",n=h.data||{},i=h.headers||{},o=new XMLHttpRequest,s=(new Date).getTime(),u=f.progress.data&&f.progress.data.startTime||s,a=0,p=null;o.upload.addEventListener("progress",function(e){if(e.lengthComputable){var t=Math.round(100*e.loaded/e.total),n=(new Date).getTime()-s;a=Math.round(e.loaded/n*1e3),u=f.progress.data&&f.progress.data.startTime||(new Date).getTime(),p=Math.ceil((e.total-e.loaded)/a),f.progress={status:m.Uploading,data:{percentage:t,speed:a,speedHuman:y(a)+"/s",startTime:u,endTime:null,eta:p,etaHuman:v.secondsToHuman(p)}},r.next({type:"uploading",file:f})}},!1),o.upload.addEventListener("error",function(e){r.error(e),r.complete()}),o.onreadystatechange=function(){if(o.readyState===XMLHttpRequest.DONE){var e=Math.round(f.size/((new Date).getTime()-u)*1e3);f.progress={status:m.Done,data:{percentage:100,speed:e,speedHuman:y(e)+"/s",startTime:u,endTime:(new Date).getTime(),eta:p,etaHuman:v.secondsToHuman(p||0)}},f.responseStatus=o.status;try{f.response=JSON.parse(o.response)}catch(t){f.response=o.response}f.responseHeaders=v.parseResponseHeaders(o.getAllResponseHeaders()),r.next({type:"done",file:f}),r.complete()}},o.open(t,e,!0),o.withCredentials=!!h.withCredentials;try{var l=f.nativeFile,d=v.queue.findIndex(function(e){return e.nativeFile===l});v.queue[d].progress.status===m.Cancelled&&r.complete(),Object.keys(n).forEach(function(e){return f.form.append(e,n[e])}),Object.keys(i).forEach(function(e){return o.setRequestHeader(e,i[e])}),f.form.append(h.fieldName||"file",l,l.name),v.serviceEvents.emit({type:"start",file:f}),o.send(f.form)}catch(c){r.complete()}return function(){o.abort()}})},e.prototype.secondsToHuman=function(e){return new Date(1e3*e).toISOString().substr(11,8)},e.prototype.generateId=function(){return Math.random().toString(36).substring(7)},e.prototype.setContentTypes=function(e){void 0!==e&&e instanceof Array?e.find(function(e){return"*"===e})!==undefined?this.contentTypes=["*"]:this.contentTypes=e:this.contentTypes=["*"]},e.prototype.allContentTypesAllowed=function(){return this.contentTypes.find(function(e){return"*"===e})!==undefined},e.prototype.isContentTypeAllowed=function(t){return!!this.allContentTypesAllowed()||this.contentTypes.find(function(e){return e===t})!==undefined},e.prototype.makeUploadFile=function(e,t){return{fileIndex:t,id:this.generateId(),name:e.name,size:e.size,type:e.type,form:new FormData,progress:{status:m.Queue,data:{percentage:0,speed:0,speedHuman:y(0)+"/s",startTime:null,endTime:null,eta:null,etaHuman:null}},lastModifiedDate:e.lastModifiedDate,sub:undefined,nativeFile:e}},e.prototype.parseResponseHeaders=function(e){if(e)return e.split("\n").map(function(e){return e.split(/: */,2)}).filter(function(e){return e[0]}).reduce(function(e,t){return e[t[0]]=t[1],e},{})},e}(),t=function(){function e(e){this.elementRef=e,this.stopEvent=function(e){e.stopPropagation(),e.preventDefault()},this.uploadOutput=new i.EventEmitter}return e.prototype.ngOnInit=function(){var t=this;this._sub=[];var e=this.options&&this.options.concurrency||Number.POSITIVE_INFINITY,n=this.options&&this.options.allowedContentTypes||["*"],r=this.options&&this.options.maxUploads||Number.POSITIVE_INFINITY;this.upload=new a(e,n,r),this.el=this.elementRef.nativeElement,this._sub.push(this.upload.serviceEvents.subscribe(function(e){t.uploadOutput.emit(e)})),this.uploadInput instanceof i.EventEmitter&&this._sub.push(this.upload.initInputEvents(this.uploadInput)),this.el.addEventListener("drop",this.stopEvent,!1),this.el.addEventListener("dragenter",this.stopEvent,!1),this.el.addEventListener("dragover",this.stopEvent,!1)},e.prototype.ngOnDestroy=function(){this._sub.forEach(function(e){return e.unsubscribe()})},e.prototype.onDrop=function(e){e.stopPropagation(),e.preventDefault();this.uploadOutput.emit({type:"drop"}),this.upload.handleFiles(e.dataTransfer.files)},e.prototype.onDragOver=function(e){if(e){this.uploadOutput.emit({type:"dragOver"})}},e.prototype.onDragLeave=function(e){if(e){this.uploadOutput.emit({type:"dragOut"})}},e.decorators=[{type:i.Directive,args:[{selector:"[ngFileDrop]"}]}],e.ctorParameters=function(){return[{type:i.ElementRef}]},e.propDecorators={options:[{type:i.Input}],uploadInput:[{type:i.Input}],uploadOutput:[{type:i.Output}],onDrop:[{type:i.HostListener,args:["drop",["$event"]]}],onDragOver:[{type:i.HostListener,args:["dragover",["$event"]]}],onDragLeave:[{type:i.HostListener,args:["dragleave",["$event"]]}]},e}(),n=function(){function e(e){var t=this;this.elementRef=e,this.fileListener=function(){t.el.files&&t.upload.handleFiles(t.el.files)},this.uploadOutput=new i.EventEmitter}return e.prototype.ngOnInit=function(){var t=this;this._sub=[];var e=this.options&&this.options.concurrency||Number.POSITIVE_INFINITY,n=this.options&&this.options.allowedContentTypes||["*"],r=this.options&&this.options.maxUploads||Number.POSITIVE_INFINITY;this.upload=new a(e,n,r),this.el=this.elementRef.nativeElement,this.el.addEventListener("change",this.fileListener,!1),this._sub.push(this.upload.serviceEvents.subscribe(function(e){t.uploadOutput.emit(e)})),this.uploadInput instanceof i.EventEmitter&&this._sub.push(this.upload.initInputEvents(this.uploadInput))},e.prototype.ngOnDestroy=function(){this.el&&(this.el.removeEventListener("change",this.fileListener,!1),this._sub.forEach(function(e){return e.unsubscribe()}))},e.decorators=[{type:i.Directive,args:[{selector:"[ngFileSelect]"}]}],e.ctorParameters=function(){return[{type:i.ElementRef}]},e.propDecorators={options:[{type:i.Input}],uploadInput:[{type:i.Input}],uploadOutput:[{type:i.Output}]},e}(),r=function(){function e(){}return e.decorators=[{type:i.NgModule,args:[{declarations:[t,n],exports:[t,n]}]}],e}();e.UploadStatus=m,e.NgFileDropDirective=t,e.NgFileSelectDirective=n,e.humanizeBytes=y,e.NgUploaderService=a,e.NgxUploaderModule=r,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=ngx-uploader.umd.min.js.map